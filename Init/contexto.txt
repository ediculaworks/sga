### RESUMO DO DATABASE

**Total de Tabelas:** 23
**Total de ENUMs:** 7
**Total de √çndices:** 48+
**Total de Triggers:** 14
**Total de Views:** 5

**Estrutura:**
- 3 tabelas de usu√°rios (usuarios, motoristas, escala)
- 4 tabelas de ambul√¢ncias (ambulancias, equipamentos_catalogo, estoque_ambulancias, gastos_ambulancias)
- 3 tabelas de checklists
- 2 tabelas de ocorr√™ncias (ocorrencias, ocorrencias_participantes)
- 5 tabelas de atendimentos (pacientes, atendimentos, atendimentos_arquivos, notas_enfermeiro_pacientes, consumo_materiais)
- 3 tabelas de sistema (notificacoes, rastreamento_ambulancias, logs_sistema)

---

## 4. STACK TECNOL√ìGICA

### Frontend Framework
- **Next.js 14+** (App Router) - Framework React full-stack
- **React 18+** - Biblioteca base
- **TypeScript** - Type safety

### Styling
- **Tailwind CSS** - Utility-first CSS
- **shadcn/ui** - Componentes React acess√≠veis
- **Lucide React** - √çcones
- **Radix UI** - Primitives (base do shadcn/ui)

### Backend/Database
- **Supabase** - PostgreSQL gerenciado
- **Supabase Auth** - Autentica√ß√£o
- **Supabase Storage** - Armazenamento de arquivos
- **Supabase Realtime** - WebSocket updates
- **Supabase JS Client** - SDK oficial

### State Management
- **Zustand** - State global simples
- **React Query (TanStack Query)** - Cache de server state

### Forms e Valida√ß√£o
- **React Hook Form** - Gerenciamento de formul√°rios
- **Zod** - Schema validation

### Mapas e GPS
- **Mapbox GL JS** ou **Google Maps API** - Mapas interativos
- **Geolocation API** - GPS nativo

### PWA (Mobile)
- **next-pwa** - Progressive Web App
- **Capacitor** (opcional) - Bridge para funcionalidades nativas

### Data e Hora
- **date-fns** - Manipula√ß√£o de datas

### Upload de Arquivos
- **Supabase Storage** - Storage integrado
- **React Dropzone** - Drag & drop

### Notifica√ß√µes
- **Web Push API** - Push notifications
- **React Hot Toast** ou **Sonner** - Toast in-app

### Gr√°ficos
- **Recharts** - Gr√°ficos React

### Dev Tools
- **ESLint** - Code quality
- **Prettier** - Formata√ß√£o
- **Husky** - Git hooks

### Deploy
- **Vercel** - Deploy otimizado para Next.js
- **GitHub Actions** - CI/CD

### Package Manager
- **pnpm** ou **npm** - Gerenciamento de depend√™ncias

---

## 5. INSTRU√á√ïES DE DESENVOLVIMENTO (claude.md)

### Pipeline de Trabalho
1. **Cursor IDE** com Claude Pro no terminal
2. **Desenvolvimento incremental** - uma funcionalidade por vez
3. **Documenta√ß√£o obrigat√≥ria** em cada etapa
4. **Commits frequentes** com mensagens descritivas
5. **Testes manuais** ap√≥s cada implementa√ß√£o

### Fases de Desenvolvimento

#### FASE 1: Setup e Funda√ß√£o ‚¨ÖÔ∏è COME√áAR AQUI
- [ ] Inicializar projeto Next.js com TypeScript
- [ ] Configurar Tailwind CSS
- [ ] Instalar e configurar shadcn/ui
- [ ] Configurar Supabase Client
- [ ] Criar estrutura de pastas
- [ ] Configurar vari√°veis de ambiente
- [ ] Setup ESLint + Prettier

#### FASE 2: Autentica√ß√£o
- [ ] Sistema de login
- [ ] Prote√ß√£o de rotas
- [ ] Gerenciamento de sess√£o
- [ ] Tipos de perfis

#### FASE 3: Layout e Navega√ß√£o
- [ ] Layout base responsivo
- [ ] Sidebar navigation
- [ ] Header com user menu
- [ ] Rotas principais por perfil

#### FASE 4: Dashboard (por perfil)
- [ ] Dashboard M√©dico
- [ ] Dashboard Enfermeiro
- [ ] Dashboard Chefe dos M√©dicos
- [ ] Dashboard Chefe das Ambul√¢ncias
- [ ] Dashboard Chefe dos Enfermeiros

#### FASE 5: Funcionalidades Core
- [ ] CRUD de Ocorr√™ncias
- [ ] Sistema de confirma√ß√£o de participantes
- [ ] Atribui√ß√£o de ambul√¢ncias
- [ ] Checklists (t√©cnico e m√©dico)

#### FASE 6: Funcionalidades Avan√ßadas
- [ ] Rastreamento GPS
- [ ] Gest√£o de estoque
- [ ] Sistema de notifica√ß√µes
- [ ] Upload de arquivos

#### FASE 7: Mobile/PWA
- [ ] Configurar PWA
- [ ] Otimiza√ß√µes mobile
- [ ] Geolocaliza√ß√£o
- [ ] Offline support

#### FASE 8: Polimento
- [ ] Testes
- [ ] Performance
- [ ] Acessibilidade
- [ ] Deploy

### Estrutura de Pastas Recomendada

```
/src
  /app
    /(auth)
      /login
    /(dashboard)
      /medico
      /enfermeiro
      /motorista
      /chefe-medicos
      /chefe-enfermeiros
      /chefe-ambulancias
    /api
  /components
    /ui (shadcn components)
    /shared
    /layout
    /dashboard
      /medico
      /enfermeiro
      /chefe-medicos
      /chefe-ambulancias
      /chefe-enfermeiros
  /lib
    /supabase
    /utils
  /types
  /hooks
  /stores
```

### Regras de Ouro

1. **SEMPRE documentar** mudan√ßas em CHANGELOG.md
2. **SEMPRE usar TypeScript** - tipos expl√≠citos
3. **SEMPRE criar componentes reutiliz√°veis** - DRY principle
4. **SEMPRE testar manualmente** antes de commit
5. **SEMPRE usar shadcn/ui** para componentes base
6. **SEMPRE validar forms** com Zod
7. **SEMPRE otimizar queries** - usar React Query
8. **SEMPRE pensar mobile-first** - responsivo
9. **SEMPRE usar Supabase RLS** - seguran√ßa
10. **SEMPRE commitar** ap√≥s cada feature completa

### Workflow de Desenvolvimento

```
1. Ler contexto atual (CHANGELOG.md)
2. Receber prompt de pr√≥xima feature
3. Planejar arquitetura/componentes
4. Implementar c√≥digo
5. Adicionar tipos TypeScript
6. Testar manualmente
7. Documentar em CHANGELOG.md
8. Atualizar README.md (se necess√°rio)
9. Commit com mensagem descritiva
10. Informar conclus√£o + pr√≥ximos passos
```

### Checklist de Qualidade

Antes de considerar uma feature completa:
- [ ] C√≥digo TypeScript sem erros
- [ ] ESLint sem warnings
- [ ] Componentes responsivos
- [ ] Loading states implementados
- [ ] Error handling implementado
- [ ] Valida√ß√£o de forms (se aplic√°vel)
- [ ] Testes manuais realizados
- [ ] CHANGELOG.md atualizado
- [ ] Coment√°rios em c√≥digo complexo
- [ ] Commit realizado

---

## 6. HIST√ìRICO DE DECIS√ïES

### Decis√µes de Arquitetura

#### Por que Next.js ao inv√©s de React puro?
- SSR para melhor SEO e performance
- API Routes integradas
- Otimiza√ß√£o autom√°tica de imagens
- Roteamento file-based
- Deploy otimizado no Vercel

#### Por que Supabase ao inv√©s de Firebase?
- PostgreSQL completo (SQL vs NoSQL)
- Row Level Security nativo
- Realtime via PostgreSQL
- Open source
- Melhor para dados relacionais complexos

#### Por que PWA ao inv√©s de React Native?
- Uma √∫nica codebase
- Manuten√ß√£o mais simples
- Deploy mais r√°pido
- Funciona em todas as plataformas
- Custos menores

#### Por que Zustand ao inv√©s de Redux?
- API mais simples
- Menos boilerplate
- Bundle menor
- Sem providers necess√°rios
- Melhor TypeScript support

#### Por que shadcn/ui ao inv√©s de Material-UI?
- N√£o √© depend√™ncia NPM (copy-paste)
- Totalmente customiz√°vel
- Tailwind CSS nativo
- Menor bundle size
- Melhor acessibilidade

### Decis√µes de Funcionalidade

#### Por que o m√©dico registra materiais ao FINAL da ocorr√™ncia?
- Mais pr√°tico durante atendimento
- Verifica itens fisicamente na ambul√¢ncia
- Uma √∫nica vez, menos chance de erro
- Facilita contagem real vs te√≥rica

#### Por que Chefe dos Enfermeiros verifica equipamentos m√©dicos?
- Especialista em materiais m√©dicos
- Conhece necessidades cl√≠nicas
- Separa√ß√£o de responsabilidades clara
- Chefe das Ambul√¢ncias foca em ve√≠culos

#### Por que tipo de ambul√¢ncia define equipe automaticamente?
- Evita erros humanos
- B√°sica sempre tem 1 enfermeiro
- Emerg√™ncia sempre tem m√©dico + enfermeiro
- Simplifica cria√ß√£o de ocorr√™ncias

#### Por que motorista inicia ocorr√™ncia (n√£o autom√°tico)?
- Confirma que equipe est√° pronta
- Permite ajustes de √∫ltima hora
- Motorista confirma sa√≠da f√≠sica
- Controle humano sobre automa√ß√£o

#### Por que tablet fixo na ambul√¢ncia?
- Motorista n√£o precisa levar dispositivo pessoal
- Sempre dispon√≠vel no ve√≠culo
- Vinculado √† ambul√¢ncia espec√≠fica
- Facilita rastreamento

---

## 7. PR√ìXIMOS PASSOS

### Imediato (Agora)

1. **Criar arquivos de documenta√ß√£o:**
   ```bash
   touch TECH_STACK.md
   touch claude.md
   touch CHANGELOG.md
   touch README.md
   ```

2. **Copiar conte√∫do dos artifacts para os arquivos**

3. **Executar PROMPT DE INICIALIZA√á√ÉO:**

```
Estou iniciando o desenvolvimento do Sistema de Gest√£o de Ambul√¢ncias.

CONTEXTO:
- Projeto Next.js 14+ com TypeScript
- Database PostgreSQL j√° configurado no Supabase (23 tabelas, triggers, views)
- Stack definida: Next.js + React + TypeScript + Tailwind + shadcn/ui
- Reposit√≥rio GitHub j√° sincronizado
- Arquivos de documenta√ß√£o criados: TECH_STACK.md, claude.md, CHANGELOG.md

TAREFA - FASE 1: Setup e Funda√ß√£o
Crie a estrutura inicial do projeto seguindo estas etapas:

1. Inicialize um novo projeto Next.js 14 com App Router e TypeScript
2. Configure Tailwind CSS
3. Instale e configure shadcn/ui com estes componentes:
   - button, card, input, label, select, toast, dropdown-menu, dialog, badge
4. Configure Supabase Client com as credenciais corretas
5. Crie a estrutura de pastas recomendada
6. Configure vari√°veis de ambiente (.env.local e .env.example)
7. Configure ESLint + Prettier

ESTRUTURA DE PASTAS ESPERADA:
/src
  /app
    /(auth)/login
    /(dashboard)
      /medico
      /enfermeiro
      /motorista
      /chefe-medicos
      /chefe-enfermeiros
      /chefe-ambulancias
    /api
  /components
    /ui (shadcn)
    /shared
    /layout
  /lib
    /supabase
    /utils
  /types
  /hooks
  /stores

DELIVERABLES:
1. Projeto Next.js rodando em localhost:3000
2. Tailwind CSS funcionando
3. shadcn/ui instalado
4. Supabase client configurado
5. README.md atualizado
6. CHANGELOG.md preenchido
7. .env.example criado

DOCUMENTA√á√ÉO OBRIGAT√ìRIA:
1. README.md - Instru√ß√µes de setup
2. CHANGELOG.md - Lista detalhada de mudan√ßas
3. Coment√°rios inline em configura√ß√µes

COME√áE AGORA!
```

### Ap√≥s FASE 1

4. **FASE 2: Sistema de Autentica√ß√£o**
   - P√°gina de login
   - Middleware de autentica√ß√£o
   - Prote√ß√£o de rotas por perfil
   - Hook useAuth

5. **FASE 3: Layout Base**
   - Sidebar responsiva
   - Navigation por perfil
   - Header com user menu
   - Mobile menu

6. **FASE 4: Primeiro Dashboard (M√©dico)**
   - Estat√≠sticas
   - Lista de ocorr√™ncias
   - Modal de detalhes
   - Confirma√ß√£o de participa√ß√£o

### Credenciais Supabase Necess√°rias

Pegar em: https://supabase.com/dashboard ‚Üí Seu Projeto ‚Üí Settings ‚Üí API

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

---

## 8. REFER√äNCIAS E LINKS √öTEIS

### Documenta√ß√£o
- **Supabase:** https://supabase.com/docs
- **Next.js:** https://nextjs.org/docs
- **shadcn/ui:** https://ui.shadcn.com
- **Tailwind CSS:** https://tailwindcss.com/docs
- **React Query:** https://tanstack.com/query
- **Zustand:** https://github.com/pmndrs/zustand
- **React Hook Form:** https://react-hook-form.com
- **Zod:** https://zod.dev

### Refer√™ncias de C√≥digo
- **Supabase Auth:** https://supabase.com/docs/guides/auth
- **Next.js App Router:** https://nextjs.org/docs/app
- **shadcn/ui Examples:** https://ui.shadcn.com/examples
- **Mapbox GL JS:** https://docs.mapbox.com/mapbox-gl-js

---

## 9. NOTAS IMPORTANTES

### Performance
- Priorizar sempre efici√™ncia e velocidade
- Agilidade √© fator cr√≠tico para o usu√°rio
- Sistema deve ser r√°pido mesmo com muitos dados

### UX/UI
- Interface touch-friendly (pensando em tablets)
- Mobile-first approach
- Loading states sempre vis√≠veis
- Feedback visual imediato

### Seguran√ßa
- Supabase RLS em todas as tabelas
- Valida√ß√£o server-side
- Sanitiza√ß√£o de inputs
- HTTPS obrigat√≥rio

### Escalabilidade
- Database normalizado
- √çndices em queries frequentes
- Cache inteligente
- Realtime apenas onde necess√°rio

### Manutenibilidade
- C√≥digo limpo e documentado
- Componentes reutiliz√°veis
- TypeScript para type safety
- Testes quando poss√≠vel

---

## 10. GLOSS√ÅRIO DO PROJETO

- **Ocorr√™ncia** = Chamada/Opera√ß√£o de ambul√¢ncia
- **Remo√ß√£o** = Transfer√™ncia de paciente para hospital
- **Status Pronta** = Ambul√¢ncia liberada (checklists OK)
- **Status Pendente** = Ambul√¢ncia aguardando verifica√ß√£o
- **Status REVIS√ÉO** = Ambul√¢ncia precisa manuten√ß√£o
- **Em Aberto** = Ocorr√™ncia criada, aguardando profissionais
- **Confirmada** = Profissionais confirmados, aguardando atribui√ß√£o
- **Em Andamento** = Opera√ß√£o ativa
- **Conclu√≠da** = Opera√ß√£o finalizada
- **Evento** = Ambul√¢ncia fica de plant√£o o dia todo
- **Domiciliar** = Atendimento na resid√™ncia do paciente
- **Emerg√™ncia** = Atendimento urgente
- **Transfer√™ncia** = Mover paciente entre hospitais
- **B√°sica** = Ambul√¢ncia sem m√©dico (s√≥ enfermeiro)
- **Emerg√™ncia (tipo)** = Ambul√¢ncia com m√©dico + enfermeiro

---

## FIM DO DOCUMENTO

**Este documento cont√©m TUDO o que foi discutido e planejado.**

**Use como refer√™ncia principal no Cursor/Claude para manter contexto completo do projeto.**

**Data:** 07 de Outubro de 2025
**Status:** Database configurado, pronto para iniciar desenvolvimento frontend
**Pr√≥ximo Passo:** Executar PROMPT DE INICIALIZA√á√ÉO (Se√ß√£o 7)### Fluxo de Gest√£o de Materiais M√©dicos

1. **Verifica√ß√£o Matinal:** Chefe dos Enfermeiros define tipo da ambul√¢ncia (Emerg√™ncia ou B√°sica), verifica e rep√µe materiais conforme checklist do tipo ‚Üí Status "Pronta"
2. **Durante Ocorr√™ncia:** M√©dico atende pacientes (n√£o registra consumo ainda)
3. **Final da Ocorr√™ncia:** M√©dico registra consumo de materiais em lista √∫nica enquanto verifica os itens na ambul√¢ncia
4. **Atualiza√ß√£o Autom√°tica:** Sistema atualiza quantidade de materiais da ambul√¢ncia em tempo real
5. **Retorno √† Base:** Ambul√¢ncia volta com status "Pendente"
6. **Nova Verifica√ß√£o:** Chefe dos Enfermeiros visualiza materiais a repor (baseado no consumo registrado)
7. **Reposi√ß√£o:** Ap√≥s repor materiais, definir tipo e aprovar checklist ‚Üí Ambul√¢ncia volta ao status "Pronta"

### Regras de Roteamento (Motorista/Tablet)

- Se a ocorr√™ncia requer buscar m√©dico: primeiro destino √© sempre a resid√™ncia do m√©dico
- Ap√≥s buscar o m√©dico: bot√£o "Pr√≥ximo Destino" direciona para o local da ocorr√™ncia
- Ao finalizar: rota de retorno √† base √© automaticamente disponibilizada

### Regras de Manuten√ß√£o

- Sistema monitora automaticamente a kilometragem de cada ambul√¢ncia
- Quando ambul√¢ncia ultrapassa kilometragem recomendada para revis√£o, status muda automaticamente para "REVIS√ÉO"
- Alertas aparecem no Dashboard do Chefe dos M√©dicos

### Verifica√ß√µes Di√°rias

**Realizadas no in√≠cio do dia, diariamente:**

#### Chefe das Ambul√¢ncias:
- Verifica par√¢metros t√©cnicos dos ve√≠culos
- Gasolina, kilometragem, temperatura, press√£o dos pneus, revis√£o

#### Chefe dos Enfermeiros:
- Verifica equipamentos m√©dicos de todas as ambul√¢ncias
- **Define o tipo de cada ambul√¢ncia (Emerg√™ncia ou B√°sica)** antes de completar checklist
- Rep√µe materiais conforme checklist do tipo escolhido
- Objetivo: deixar toda a frota com status "Pronta" no in√≠cio do dia

---

## 3. ESTRUTURA DO DATABASE (PostgreSQL)

### C√ìDIGO SQL COMPLETO - DIVIDIDO EM 9 PARTES

#### PARTE 1: ENUMS E TABELAS DE USU√ÅRIOS

```sql
-- ============================================
-- PARTE 1: ENUMS E TABELAS DE USU√ÅRIOS
-- Execute esta parte primeiro
-- ============================================

-- ENUMS
CREATE TYPE tipo_perfil AS ENUM (
    'MEDICO',
    'ENFERMEIRO',
    'MOTORISTA',
    'CHEFE_MEDICOS',
    'CHEFE_ENFERMEIROS',
    'CHEFE_AMBULANCIAS'
);

CREATE TYPE status_ocorrencia AS ENUM (
    'EM_ABERTO',
    'CONFIRMADA',
    'EM_ANDAMENTO',
    'CONCLUIDA'
);

CREATE TYPE tipo_ambulancia AS ENUM (
    'BASICA',
    'EMERGENCIA'
);

CREATE TYPE tipo_trabalho AS ENUM (
    'EVENTO',
    'DOMICILIAR',
    'EMERGENCIA',
    'TRANSFERENCIA'
);

CREATE TYPE status_ambulancia AS ENUM (
    'PRONTA',
    'PENDENTE',
    'REVISAO',
    'EM_OPERACAO'
);

CREATE TYPE categoria_equipamento AS ENUM (
    'VIAS_AEREAS_AMBU',
    'EPI_INDIVIDUAL',
    'PROCEDIMENTO_PUNCAO',
    'MATERIAIS_ELETRICOS',
    'MATERIAL_AMB_GERAL',
    'SUTURA_BOLSA',
    'SONDAGEM_BOLSA'
);

CREATE TYPE sexo AS ENUM ('MASCULINO', 'FEMININO', 'OUTRO');

-- TABELA: usuarios
CREATE TABLE usuarios (
    id SERIAL PRIMARY KEY,
    nome_completo VARCHAR(255) NOT NULL,
    cpf VARCHAR(14) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    telefone VARCHAR(20),
    senha_hash VARCHAR(255) NOT NULL,
    tipo_perfil tipo_perfil NOT NULL,
    idade INTEGER,
    sexo sexo,
    endereco_completo TEXT,
    data_admissao DATE,
    ativo BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_usuarios_tipo_perfil ON usuarios(tipo_perfil);
CREATE INDEX idx_usuarios_ativo ON usuarios(ativo);
CREATE INDEX idx_usuarios_cpf ON usuarios(cpf);

-- TABELA: motoristas
CREATE TABLE motoristas (
    id SERIAL PRIMARY KEY,
    usuario_id INTEGER UNIQUE NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,
    cnh VARCHAR(20) UNIQUE NOT NULL,
    validade_cnh DATE NOT NULL,
    categoria_cnh VARCHAR(5) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_motoristas_usuario_id ON motoristas(usuario_id);

-- TABELA: escala
CREATE TABLE escala (
    id SERIAL PRIMARY KEY,
    usuario_id INTEGER NOT NULL REFERENCES usuarios(id) ON DELETE CASCADE,
    data DATE NOT NULL,
    disponivel BOOLEAN DEFAULT TRUE,
    observacoes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(usuario_id, data)
);

CREATE INDEX idx_escala_usuario_data ON escala(usuario_id, data);
CREATE INDEX idx_escala_data ON escala(data);
```

#### PARTE 2: TABELAS DE AMBUL√ÇNCIAS

```sql
-- ============================================
-- PARTE 2: TABELAS DE AMBUL√ÇNCIAS
-- Execute ap√≥s a Parte 1
-- ============================================

-- TABELA: ambulancias
CREATE TABLE ambulancias (
    id SERIAL PRIMARY KEY,
    placa VARCHAR(10) UNIQUE NOT NULL,
    marca VARCHAR(100) NOT NULL,
    modelo VARCHAR(100) NOT NULL,
    ano INTEGER NOT NULL,
    motor VARCHAR(50),
    kilometragem DECIMAL(10, 2) NOT NULL DEFAULT 0,
    ultima_revisao DATE,
    proxima_revisao DATE,
    kilometragem_proxima_revisao DECIMAL(10, 2),
    status_ambulancia status_ambulancia DEFAULT 'PENDENTE',
    tipo_atual tipo_ambulancia,
    tablet_id VARCHAR(100) UNIQUE,
    ativo BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_ambulancias_status ON ambulancias(status_ambulancia);
CREATE INDEX idx_ambulancias_tipo ON ambulancias(tipo_atual);
CREATE INDEX idx_ambulancias_placa ON ambulancias(placa);

-- TABELA: equipamentos_catalogo
CREATE TABLE equipamentos_catalogo (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    categoria categoria_equipamento NOT NULL,
    tipo_ambulancia tipo_ambulancia NOT NULL,
    unidade_medida VARCHAR(50) DEFAULT 'unidade',
    descricao TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_equipamentos_categoria ON equipamentos_catalogo(categoria);
CREATE INDEX idx_equipamentos_tipo ON equipamentos_catalogo(tipo_ambulancia);

-- TABELA: estoque_ambulancias
CREATE TABLE estoque_ambulancias (
    id SERIAL PRIMARY KEY,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id) ON DELETE CASCADE,
    equipamento_id INTEGER NOT NULL REFERENCES equipamentos_catalogo(id) ON DELETE CASCADE,
    quantidade_atual DECIMAL(10, 2) NOT NULL DEFAULT 0,
    quantidade_minima DECIMAL(10, 2) DEFAULT 0,
    ultima_verificacao TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(ambulancia_id, equipamento_id)
);

CREATE INDEX idx_estoque_ambulancia ON estoque_ambulancias(ambulancia_id);
CREATE INDEX idx_estoque_equipamento ON estoque_ambulancias(equipamento_id);

-- TABELA: gastos_ambulancias
CREATE TABLE gastos_ambulancias (
    id SERIAL PRIMARY KEY,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id) ON DELETE CASCADE,
    tipo_gasto VARCHAR(100) NOT NULL,
    valor DECIMAL(10, 2) NOT NULL,
    descricao TEXT,
    data_gasto DATE NOT NULL,
    registrado_por INTEGER REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_gastos_ambulancia ON gastos_ambulancias(ambulancia_id);
CREATE INDEX idx_gastos_data ON gastos_ambulancias(data_gasto);
CREATE INDEX idx_gastos_tipo ON gastos_ambulancias(tipo_gasto);
```

#### PARTE 3: TABELAS DE CHECKLISTS

```sql
-- ============================================
-- PARTE 3: TABELAS DE CHECKLISTS
-- Execute ap√≥s a Parte 2
-- ============================================

-- TABELA: checklist_tecnico_ambulancias
CREATE TABLE checklist_tecnico_ambulancias (
    id SERIAL PRIMARY KEY,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id) ON DELETE CASCADE,
    verificado_por INTEGER NOT NULL REFERENCES usuarios(id),
    data_verificacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    gasolina_ok BOOLEAN DEFAULT FALSE,
    kilometragem_registrada DECIMAL(10, 2),
    temperatura_ok BOOLEAN DEFAULT FALSE,
    pressao_pneus_ok BOOLEAN DEFAULT FALSE,
    revisao_ok BOOLEAN DEFAULT FALSE,
    observacoes TEXT,
    aprovado BOOLEAN DEFAULT FALSE
);

CREATE INDEX idx_checklist_tecnico_ambulancia ON checklist_tecnico_ambulancias(ambulancia_id);
CREATE INDEX idx_checklist_tecnico_data ON checklist_tecnico_ambulancias(data_verificacao);

-- TABELA: checklist_equipamentos_ambulancias
CREATE TABLE checklist_equipamentos_ambulancias (
    id SERIAL PRIMARY KEY,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id) ON DELETE CASCADE,
    verificado_por INTEGER NOT NULL REFERENCES usuarios(id),
    data_verificacao TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    tipo_definido tipo_ambulancia NOT NULL,
    observacoes TEXT,
    aprovado BOOLEAN DEFAULT FALSE
);

CREATE INDEX idx_checklist_equip_ambulancia ON checklist_equipamentos_ambulancias(ambulancia_id);
CREATE INDEX idx_checklist_equip_data ON checklist_equipamentos_ambulancias(data_verificacao);

-- TABELA: checklist_equipamentos_itens
CREATE TABLE checklist_equipamentos_itens (
    id SERIAL PRIMARY KEY,
    checklist_id INTEGER NOT NULL REFERENCES checklist_equipamentos_ambulancias(id) ON DELETE CASCADE,
    equipamento_id INTEGER NOT NULL REFERENCES equipamentos_catalogo(id),
    quantidade_verificada DECIMAL(10, 2) NOT NULL,
    quantidade_reposta DECIMAL(10, 2) DEFAULT 0,
    conforme BOOLEAN DEFAULT TRUE,
    observacoes TEXT
);

CREATE INDEX idx_checklist_itens_checklist ON checklist_equipamentos_itens(checklist_id);
```

#### PARTE 4: TABELAS DE OCORR√äNCIAS

```sql
-- ============================================
-- PARTE 4: TABELAS DE OCORR√äNCIAS
-- Execute ap√≥s a Parte 3
-- ============================================

-- TABELA: ocorrencias
CREATE TABLE ocorrencias (
    id SERIAL PRIMARY KEY,
    numero_ocorrencia VARCHAR(50) UNIQUE NOT NULL,
    tipo_ambulancia tipo_ambulancia NOT NULL,
    tipo_trabalho tipo_trabalho NOT NULL,
    status_ocorrencia status_ocorrencia DEFAULT 'EM_ABERTO',
    descricao TEXT,
    local_ocorrencia TEXT NOT NULL,
    endereco_completo TEXT,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    data_ocorrencia DATE NOT NULL,
    horario_saida TIME NOT NULL,
    horario_chegada_local TIME,
    horario_termino TIME,
    carga_horaria INTEGER,
    criado_por INTEGER NOT NULL REFERENCES usuarios(id),
    ambulancia_id INTEGER REFERENCES ambulancias(id),
    motorista_id INTEGER REFERENCES usuarios(id),
    data_atribuicao TIMESTAMP,
    data_inicio TIMESTAMP,
    data_conclusao TIMESTAMP,
    duracao_total INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_ocorrencias_status ON ocorrencias(status_ocorrencia);
CREATE INDEX idx_ocorrencias_tipo ON ocorrencias(tipo_trabalho);
CREATE INDEX idx_ocorrencias_data ON ocorrencias(data_ocorrencia);
CREATE INDEX idx_ocorrencias_ambulancia ON ocorrencias(ambulancia_id);
CREATE INDEX idx_ocorrencias_numero ON ocorrencias(numero_ocorrencia);

-- TABELA: ocorrencias_participantes
CREATE TABLE ocorrencias_participantes (
    id SERIAL PRIMARY KEY,
    ocorrencia_id INTEGER NOT NULL REFERENCES ocorrencias(id) ON DELETE CASCADE,
    usuario_id INTEGER NOT NULL REFERENCES usuarios(id),
    funcao tipo_perfil NOT NULL,
    valor_pagamento DECIMAL(10, 2),
    data_pagamento DATE,
    pago BOOLEAN DEFAULT FALSE,
    confirmado BOOLEAN DEFAULT FALSE,
    data_confirmacao TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(ocorrencia_id, usuario_id)
);

CREATE INDEX idx_participantes_ocorrencia ON ocorrencias_participantes(ocorrencia_id);
CREATE INDEX idx_participantes_usuario ON ocorrencias_participantes(usuario_id);
CREATE INDEX idx_participantes_pago ON ocorrencias_participantes(pago);
```

#### PARTE 5: TABELAS DE PACIENTES E ATENDIMENTOS

```sql
-- ============================================
-- PARTE 5: TABELAS DE PACIENTES E ATENDIMENTOS
-- Execute ap√≥s a Parte 4
-- ============================================

-- TABELA: pacientes
CREATE TABLE pacientes (
    id SERIAL PRIMARY KEY,
    nome_completo VARCHAR(255) NOT NULL,
    cpf VARCHAR(14) UNIQUE,
    data_nascimento DATE,
    idade INTEGER,
    sexo sexo,
    telefone VARCHAR(20),
    endereco_completo TEXT,
    contato_emergencia VARCHAR(255),
    telefone_emergencia VARCHAR(20),
    observacoes_gerais TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_pacientes_nome ON pacientes(nome_completo);
CREATE INDEX idx_pacientes_cpf ON pacientes(cpf);

-- TABELA: atendimentos
CREATE TABLE atendimentos (
    id SERIAL PRIMARY KEY,
    ocorrencia_id INTEGER NOT NULL REFERENCES ocorrencias(id) ON DELETE CASCADE,
    paciente_id INTEGER NOT NULL REFERENCES pacientes(id),
    medico_id INTEGER REFERENCES usuarios(id),
    data_atendimento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    queixa_principal TEXT,
    quadro_clinico TEXT,
    procedimentos_realizados TEXT,
    diagnostico TEXT,
    remocao BOOLEAN DEFAULT FALSE,
    hospital_destino VARCHAR(255),
    observacoes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_atendimentos_ocorrencia ON atendimentos(ocorrencia_id);
CREATE INDEX idx_atendimentos_paciente ON atendimentos(paciente_id);
CREATE INDEX idx_atendimentos_medico ON atendimentos(medico_id);
CREATE INDEX idx_atendimentos_data ON atendimentos(data_atendimento);

-- TABELA: atendimentos_arquivos
CREATE TABLE atendimentos_arquivos (
    id SERIAL PRIMARY KEY,
    atendimento_id INTEGER NOT NULL REFERENCES atendimentos(id) ON DELETE CASCADE,
    tipo_arquivo VARCHAR(50) NOT NULL,
    nome_arquivo VARCHAR(255) NOT NULL,
    caminho_arquivo TEXT NOT NULL,
    tamanho_bytes BIGINT,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_arquivos_atendimento ON atendimentos_arquivos(atendimento_id);

-- TABELA: notas_enfermeiro_pacientes
CREATE TABLE notas_enfermeiro_pacientes (
    id SERIAL PRIMARY KEY,
    atendimento_id INTEGER NOT NULL REFERENCES atendimentos(id) ON DELETE CASCADE,
    enfermeiro_id INTEGER NOT NULL REFERENCES usuarios(id),
    nota TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_notas_atendimento ON notas_enfermeiro_pacientes(atendimento_id);
CREATE INDEX idx_notas_enfermeiro ON notas_enfermeiro_pacientes(enfermeiro_id);

-- TABELA: consumo_materiais
CREATE TABLE consumo_materiais (
    id SERIAL PRIMARY KEY,
    ocorrencia_id INTEGER NOT NULL REFERENCES ocorrencias(id) ON DELETE CASCADE,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id),
    equipamento_id INTEGER NOT NULL REFERENCES equipamentos_catalogo(id),
    quantidade_utilizada DECIMAL(10, 2) NOT NULL,
    registrado_por INTEGER NOT NULL REFERENCES usuarios(id),
    data_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_consumo_ocorrencia ON consumo_materiais(ocorrencia_id);
CREATE INDEX idx_consumo_ambulancia ON consumo_materiais(ambulancia_id);
CREATE INDEX idx_consumo_equipamento ON consumo_materiais(equipamento_id);
```

#### PARTE 6: TABELAS DE SISTEMA

```sql
-- ============================================
-- PARTE 6: TABELAS DE SISTEMA
-- Execute ap√≥s a Parte 5
-- ============================================

-- TABELA: notificacoes
CREATE TABLE notificacoes (
    id SERIAL PRIMARY KEY,
    remetente_id INTEGER REFERENCES usuarios(id),
    destinatario_id INTEGER REFERENCES usuarios(id),
    ocorrencia_id INTEGER REFERENCES ocorrencias(id),
    tipo_notificacao VARCHAR(50) NOT NULL,
    titulo VARCHAR(255) NOT NULL,
    mensagem TEXT NOT NULL,
    lida BOOLEAN DEFAULT FALSE,
    data_leitura TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_notificacoes_destinatario ON notificacoes(destinatario_id);
CREATE INDEX idx_notificacoes_lida ON notificacoes(lida);
CREATE INDEX idx_notificacoes_data ON notificacoes(created_at);

-- TABELA: rastreamento_ambulancias
CREATE TABLE rastreamento_ambulancias (
    id SERIAL PRIMARY KEY,
    ambulancia_id INTEGER NOT NULL REFERENCES ambulancias(id) ON DELETE CASCADE,
    ocorrencia_id INTEGER REFERENCES ocorrencias(id),
    latitude DECIMAL(10, 8) NOT NULL,
    longitude DECIMAL(11, 8) NOT NULL,
    velocidade DECIMAL(5, 2),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_rastreamento_ambulancia ON rastreamento_ambulancias(ambulancia_id);
CREATE INDEX idx_rastreamento_timestamp ON rastreamento_ambulancias(timestamp);
CREATE INDEX idx_rastreamento_ocorrencia ON rastreamento_ambulancias(ocorrencia_id);

-- TABELA: logs_sistema
CREATE TABLE logs_sistema (
    id SERIAL PRIMARY KEY,
    usuario_id INTEGER REFERENCES usuarios(id),
    acao VARCHAR(100) NOT NULL,
    tabela_afetada VARCHAR(100),
    registro_id INTEGER,
    descricao TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_logs_usuario ON logs_sistema(usuario_id);
CREATE INDEX idx_logs_acao ON logs_sistema(acao);
CREATE INDEX idx_logs_data ON logs_sistema(created_at);
```

#### PARTE 7: TRIGGERS B√ÅSICOS

```sql
-- ============================================
-- PARTE 7: TRIGGERS B√ÅSICOS
-- Execute ap√≥s a Parte 6
-- ============================================

-- Fun√ß√£o para atualizar updated_at automaticamente
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$ language 'plpgsql';

-- Aplicar trigger nas tabelas
CREATE TRIGGER update_usuarios_updated_at BEFORE UPDATE ON usuarios
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_motoristas_updated_at BEFORE UPDATE ON motoristas
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_escala_updated_at BEFORE UPDATE ON escala
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_ambulancias_updated_at BEFORE UPDATE ON ambulancias
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_equipamentos_updated_at BEFORE UPDATE ON equipamentos_catalogo
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_estoque_updated_at BEFORE UPDATE ON estoque_ambulancias
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_ocorrencias_updated_at BEFORE UPDATE ON ocorrencias
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_pacientes_updated_at BEFORE UPDATE ON pacientes
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_atendimentos_updated_at BEFORE UPDATE ON atendimentos
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

#### PARTE 8: TRIGGERS DE L√ìGICA DE NEG√ìCIO

```sql
-- ============================================
-- PARTE 8: TRIGGERS DE L√ìGICA DE NEG√ìCIO
-- Execute ap√≥s a Parte 7
-- ============================================

-- Trigger: Atualizar estoque ap√≥s consumo
CREATE OR REPLACE FUNCTION atualizar_estoque_apos_consumo()
RETURNS TRIGGER AS $
BEGIN
    UPDATE estoque_ambulancias
    SET quantidade_atual = quantidade_atual - NEW.quantidade_utilizada,
        updated_at = CURRENT_TIMESTAMP
    WHERE ambulancia_id = NEW.ambulancia_id
    AND equipamento_id = NEW.equipamento_id;
    
    RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_atualizar_estoque
AFTER INSERT ON consumo_materiais
FOR EACH ROW
EXECUTE FUNCTION atualizar_estoque_apos_consumo();

-- Trigger: Mudar status ambul√¢ncia para PENDENTE ap√≥s retorno
CREATE OR REPLACE FUNCTION mudar_status_ambulancia_apos_conclusao()
RETURNS TRIGGER AS $
BEGIN
    IF NEW.status_ocorrencia = 'CONCLUIDA' AND OLD.status_ocorrencia != 'CONCLUIDA' THEN
        UPDATE ambulancias
        SET status_ambulancia = 'PENDENTE',
            updated_at = CURRENT_TIMESTAMP
        WHERE id = NEW.ambulancia_id;
    END IF;
    
    RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_status_ambulancia_conclusao
AFTER UPDATE ON ocorrencias
FOR EACH ROW
EXECUTE FUNCTION mudar_status_ambulancia_apos_conclusao();

-- Trigger: Verificar kilometragem para revis√£o
CREATE OR REPLACE FUNCTION verificar_revisao_ambulancia()
RETURNS TRIGGER AS $
BEGIN
    IF NEW.kilometragem >= NEW.kilometragem_proxima_revisao THEN
        NEW.status_ambulancia = 'REVISAO';
        
        INSERT INTO notificacoes (tipo_notificacao, titulo, mensagem)
        VALUES (
            'MANUTENCAO',
            'Ambul√¢ncia necessita revis√£o',
            'A ambul√¢ncia ' || NEW.placa || ' atingiu a kilometragem para revis√£o.'
        );
    END IF;
    
    RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_verificar_revisao
BEFORE UPDATE ON ambulancias
FOR EACH ROW
EXECUTE FUNCTION verificar_revisao_ambulancia();

-- Trigger: Calcular dura√ß√£o total da ocorr√™ncia
CREATE OR REPLACE FUNCTION calcular_duracao_ocorrencia()
RETURNS TRIGGER AS $
BEGIN
    IF NEW.status_ocorrencia = 'CONCLUIDA' AND NEW.data_inicio IS NOT NULL AND NEW.data_conclusao IS NOT NULL THEN
        NEW.duracao_total = EXTRACT(EPOCH FROM (NEW.data_conclusao - NEW.data_inicio)) / 60;
    END IF;
    
    RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_calcular_duracao
BEFORE UPDATE ON ocorrencias
FOR EACH ROW
EXECUTE FUNCTION calcular_duracao_ocorrencia();

-- Trigger: Mudar status ocorr√™ncia para CONFIRMADA automaticamente
CREATE OR REPLACE FUNCTION verificar_ocorrencia_confirmada()
RETURNS TRIGGER AS $
DECLARE
    vagas_necessarias INTEGER;
    vagas_preenchidas INTEGER;
    tipo_amb tipo_ambulancia;
BEGIN
    SELECT tipo_ambulancia INTO tipo_amb FROM ocorrencias WHERE id = NEW.ocorrencia_id;
    
    IF tipo_amb = 'BASICA' THEN
        vagas_necessarias := 1;
    ELSE
        vagas_necessarias := 2;
    END IF;
    
    SELECT COUNT(*) INTO vagas_preenchidas
    FROM ocorrencias_participantes
    WHERE ocorrencia_id = NEW.ocorrencia_id AND confirmado = TRUE;
    
    IF vagas_preenchidas >= vagas_necessarias THEN
        UPDATE ocorrencias
        SET status_ocorrencia = 'CONFIRMADA',
            updated_at = CURRENT_TIMESTAMP
        WHERE id = NEW.ocorrencia_id AND status_ocorrencia = 'EM_ABERTO';
    END IF;
    
    RETURN NEW;
END;
$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_verificar_confirmacao
AFTER INSERT OR UPDATE ON ocorrencias_participantes
FOR EACH ROW
WHEN (NEW.confirmado = TRUE)
EXECUTE FUNCTION verificar_ocorrencia_confirmada();
```

#### PARTE 9: VIEWS PARA RELAT√ìRIOS (FINAL)

```sql
-- ============================================
-- PARTE 9: VIEWS PARA RELAT√ìRIOS (FINAL)
-- Execute ap√≥s a Parte 8
-- ============================================

-- View: Resumo de ocorr√™ncias por per√≠odo
CREATE VIEW vw_resumo_ocorrencias AS
SELECT 
    DATE_TRUNC('month', data_ocorrencia) as mes,
    tipo_trabalho,
    tipo_ambulancia,
    status_ocorrencia,
    COUNT(*) as total_ocorrencias,
    AVG(duracao_total) as duracao_media_minutos
FROM ocorrencias
GROUP BY DATE_TRUNC('month', data_ocorrencia), tipo_trabalho, tipo_ambulancia, status_ocorrencia;

-- View: Estat√≠sticas por ambul√¢ncia
CREATE VIEW vw_estatisticas_ambulancias AS
SELECT 
    a.id,
    a.placa,
    a.modelo,
    a.status_ambulancia,
    COUNT(DISTINCT o.id) as total_ocorrencias,
    SUM(CASE WHEN o.tipo_trabalho = 'EMERGENCIA' THEN 1 ELSE 0 END) as total_emergencias,
    SUM(CASE WHEN o.tipo_trabalho = 'EVENTO' THEN 1 ELSE 0 END) as total_eventos,
    SUM(CASE WHEN o.tipo_trabalho = 'DOMICILIAR' THEN 1 ELSE 0 END) as total_domiciliar,
    SUM(CASE WHEN o.tipo_trabalho = 'TRANSFERENCIA' THEN 1 ELSE 0 END) as total_transferencias,
    COALESCE(SUM(g.valor), 0) as total_gastos
FROM ambulancias a
LEFT JOIN ocorrencias o ON a.id = o.ambulancia_id
LEFT JOIN gastos_ambulancias g ON a.id = g.ambulancia_id
GROUP BY a.id, a.placa, a.modelo, a.status_ambulancia;

-- View: Profissionais dispon√≠veis por data
CREATE VIEW vw_profissionais_disponiveis AS
SELECT 
    e.data,
    u.id as usuario_id,
    u.nome_completo,
    u.tipo_perfil,
    e.disponivel,
    CASE 
        WHEN EXISTS (
            SELECT 1 FROM ocorrencias_participantes op
            JOIN ocorrencias o ON op.ocorrencia_id = o.id
            WHERE op.usuario_id = u.id 
            AND o.data_ocorrencia = e.data
            AND o.status_ocorrencia IN ('CONFIRMADA', 'EM_ANDAMENTO')
        ) THEN FALSE
        ELSE TRUE
    END as livre_para_ocorrencias
FROM escala e
JOIN usuarios u ON e.usuario_id = u.id
WHERE u.tipo_perfil IN ('MEDICO', 'ENFERMEIRO')
AND u.ativo = TRUE;

-- View: Estoque baixo de equipamentos
CREATE VIEW vw_estoque_baixo AS
SELECT 
    a.placa,
    ec.nome as equipamento,
    ec.categoria,
    ea.quantidade_atual,
    ea.quantidade_minima,
    (ea.quantidade_minima - ea.quantidade_atual) as quantidade_a_repor
FROM estoque_ambulancias ea
JOIN ambulancias a ON ea.ambulancia_id = a.id
JOIN equipamentos_catalogo ec ON ea.equipamento_id = ec.id
WHERE ea.quantidade_atual < ea.quantidade_minima;

-- View: Pagamentos pendentes
CREATE VIEW vw_pagamentos_pendentes AS
SELECT 
    o.numero_ocorrencia,
    o.data_ocorrencia,
    o.tipo_trabalho,
    u.nome_completo as profissional,
    u.tipo_perfil,
    op.valor_pagamento,
    op.data_pagamento
FROM ocorrencias_participantes op
JOIN ocorrencias o ON op.ocorrencia_id = o.id
JOIN usuarios u ON op.usuario_id = u.id
WHERE op.pago = FALSE
AND o.status_ocorrencia = 'CONCLUIDA'
ORDER BY op.data_pagamento;
```

### RESUMO DO DATABASE

**Total de Tabelas:** 23
**Total de ENUMs:** 7
**Total de √çndices:** 48+
**Total de Triggers:** 14
**Total de Views:** 5

**Estrutura:**
- 3 tabelas de usu√°rios (usuarios, motoristas, escala)
- 4 tabelas de ambul√¢ncias (ambulancias, equipamentos_catalogo, estoque_ambulancias, gastos_ambulancias)
- 3 tabelas de checklists
- # SISTEMA DE GEST√ÉO DE AMBUL√ÇNCIAS - CONTEXTO COMPLETO DO PROJETO

**Data de Cria√ß√£o:** 07 de Outubro de 2025
**Desenvolvedor:** [Seu Nome]
**Assistente:** Claude (Anthropic)
**Reposit√≥rio:** GitHub (sincronizado)
**Database:** PostgreSQL via Supabase (configurado)

---

## üìã √çNDICE

1. RESUMO EXECUTIVO
2. DOCUMENTA√á√ÉO FUNCIONAL COMPLETA
3. ESTRUTURA DO DATABASE (PostgreSQL)
4. STACK TECNOL√ìGICA
5. INSTRU√á√ïES DE DESENVOLVIMENTO
6. HIST√ìRICO DE DECIS√ïES
7. PR√ìXIMOS PASSOS

---

## 1. RESUMO EXECUTIVO

### Objetivo do Sistema
Sistema completo de gest√£o de ambul√¢ncias para empresa que atende:
- Eventos (ambul√¢ncia fica de plant√£o o dia todo)
- Emerg√™ncias
- Atendimentos domiciliares
- Transfer√™ncias de pacientes

### Plataformas
- Web (Desktop)
- Mobile iOS (PWA)
- Mobile Android (PWA)

### Usu√°rios do Sistema (6 Perfis)
1. **M√©dico** - Profissional que atende pacientes
2. **Enfermeiro** - Profissional auxiliar
3. **Motorista** - Tablet fixo na ambul√¢ncia
4. **Chefe dos M√©dicos** - Cria ocorr√™ncias, gerencia equipe m√©dica
5. **Chefe dos Enfermeiros** - Verifica equipamentos m√©dicos
6. **Chefe das Ambul√¢ncias** - Verifica ve√≠culos, atribui recursos

---

## 2. DOCUMENTA√á√ÉO FUNCIONAL COMPLETA

### PERFIL: M√âDICO

#### P√ÅGINA: Dashboard/Home
**Funcionalidades principais:**
- Visualiza√ß√£o de ocorr√™ncias dispon√≠veis para inscri√ß√£o
- Filtro autom√°tico: n√£o aparecem ocorr√™ncias se o m√©dico estiver de folga ou j√° alocado no mesmo hor√°rio
- Destaque visual das ocorr√™ncias j√° confirmadas

**Estat√≠sticas exibidas:**
- Ocorr√™ncias atendidas por ele na semana (m√™s/ano)
- Ocorr√™ncias √† receber (ao clicar nesta box mostrar data de pagamento de cada uma dessas ocorr√™ncias n√£o pagas)
- Quantidade de remo√ß√µes na semana/m√™s ("remo√ß√£o" √© transfer√™ncia de paciente para hospital)

**Componentes:**

‚Üí Componente: Detalhes da Ocorr√™ncia (Modal/Expandido)
*Acionado ao clicar em uma ocorr√™ncia no Dashboard*

**Varia√ß√£o por Status:**

Status: "EM ABERTO"
- Descri√ß√£o da ocorr√™ncia
- Local da ocorr√™ncia
- Tipo de ocorr√™ncia (Emerg√™ncia, transfer√™ncia, evento, domiciliar)
- Fun√ß√µes na ocorr√™ncia (em aberto as que ainda n√£o foram preenchidas. As que j√° foram, mostrar o nome da pessoa que est√° confirmada na fun√ß√£o)
- Hor√°rio de sa√≠da e hor√°rio no local
- No caso de "evento", mostrar hor√°rio de t√©rmino

Status: "CONFIRMADA"
*Status autom√°tico quando todas as fun√ß√µes necess√°rias s√£o confirmadas pelos funcion√°rios*
- Data, hor√°rio e local de sa√≠da da ambul√¢ncia
- Tipo de ocorr√™ncia
- Tipo de Ambul√¢ncia
- Carga Hor√°ria (no caso de eventos)
- Placa da ambul√¢ncia (ap√≥s atribui√ß√£o pelo Chefe das Ambul√¢ncias)
- Local da ocorr√™ncia
- Descri√ß√£o da ocorr√™ncia

Status: "EM ANDAMENTO"
- Localiza√ß√£o em tempo real da ambul√¢ncia
- Fazer Cadastro de pacientes
- Input para adicionar fotos e documentos do paciente
- Formul√°rio padr√£o (seguindo modelos de sistemas hospitalares modernos - checkbox de "remo√ß√£o" interpretado pelo sistema nos prontu√°rios)

**Ao final da ocorr√™ncia (antes de concluir):**

‚Üí Componente Obrigat√≥rio: Registro de Consumo de Materiais
*Deve ser preenchido obrigatoriamente pelo m√©dico ao final da ocorr√™ncia, enquanto verifica os itens na ambul√¢ncia*

**Funcionalidades:**
- Lista com todos os materiais m√©dicos dispon√≠veis na ambul√¢ncia (mesma lista do checklist do Chefe dos Enfermeiros)
- Campo para registrar quantidade utilizada de cada item durante toda a ocorr√™ncia
- Preenchido uma √∫nica vez ao final (n√£o durante atendimentos)
- Atualiza√ß√£o autom√°tica do estoque da ambul√¢ncia no sistema
- Sistema interno (n√£o vis√≠vel no prontu√°rio do paciente)

#### P√ÅGINA: Agenda
- Visualiza√ß√£o mensal com todos os jobs confirmados
- Ao clicar em uma ocorr√™ncia espec√≠fica, abre o componente "Detalhes da Ocorr√™ncia"

#### P√ÅGINA: Pacientes
*(Banco de Dados - Mesma do Chefe dos M√©dicos)*
- Reposit√≥rio de informa√ß√µes sobre os pacientes atendidos
- √â poss√≠vel buscar pelo nome, ID de ocorr√™ncia ou data
- √â poss√≠vel clicar em um paciente espec√≠fico e "expandir" seus √∫ltimos atendimentos e informa√ß√µes pessoais

**Colunas da tabela:**
- Nome, Idade, Sexo, Data do √∫ltimo atendimento, Local, M√©dico que atendeu, Ocorr√™ncia, Queixa principal

‚Üí Componente: Hist√≥rico do Paciente (Expandido)
*Ao clicar em um paciente espec√≠fico*
- Lista com √∫ltimos atendimentos
- Hist√≥rico completo
- Ao clicar em um atendimento: visualiza√ß√£o do prontu√°rio e arquivos do m√©dico sobre aquele atendimento

---

### PERFIL: ENFERMEIRO

#### P√ÅGINA: Dashboard/Home
**Funcionalidades principais:**
- Visualiza√ß√£o de ocorr√™ncias dispon√≠veis para inscri√ß√£o
- Filtro autom√°tico: n√£o aparecem ocorr√™ncias se o enfermeiro estiver de folga ou j√° alocado no mesmo hor√°rio
- Destaque visual das ocorr√™ncias j√° confirmadas

**Estat√≠sticas exibidas:**
- Ocorr√™ncias atendidas por ele na semana (m√™s/ano)
- Ocorr√™ncias √† receber (ao clicar nesta box mostrar data de pagamento de cada uma dessas ocorr√™ncias n√£o pagas)
- Quantidade de remo√ß√µes na semana/m√™s ("remo√ß√£o" √© transfer√™ncia de paciente para hospital)

**Componentes:**

‚Üí Componente: Detalhes da Ocorr√™ncia (Modal/Expandido)

Status: "EM ABERTO"
- Descri√ß√£o da ocorr√™ncia
- Local da ocorr√™ncia
- Tipo de ocorr√™ncia (Emerg√™ncia, transfer√™ncia, evento, domiciliar)
- Fun√ß√µes na ocorr√™ncia
- Hor√°rio de sa√≠da e hor√°rio no local
- No caso de "evento", mostrar hor√°rio de t√©rmino

Status: "CONFIRMADA"
*Status autom√°tico quando todas as fun√ß√µes necess√°rias s√£o confirmadas pelos funcion√°rios*
- Data, hor√°rio e local de sa√≠da da ambul√¢ncia
- Tipo de ocorr√™ncia
- Tipo de Ambul√¢ncia
- Carga Hor√°ria (no caso de eventos)
- Placa da ambul√¢ncia (ap√≥s atribui√ß√£o pelo Chefe das Ambul√¢ncias)
- Local da ocorr√™ncia
- Descri√ß√£o da ocorr√™ncia

Status: "EM ANDAMENTO"
- Localiza√ß√£o em tempo real da ambul√¢ncia

‚Üí Componente: Notas sobre Pacientes
*Dispon√≠vel durante ocorr√™ncia em andamento*
- Enfermeiro pode clicar em qualquer paciente atendido durante a ocorr√™ncia
- Abre campo para atribuir uma "Nota" sobre aquele paciente espec√≠fico
- Nota fica salva nos dados do atendimento daquele paciente
- Pode ser acessada posteriormente no banco de dados de pacientes

#### P√ÅGINA: Agenda
- Visualiza√ß√£o mensal com todos os jobs confirmados
- Ao clicar em uma ocorr√™ncia espec√≠fica, abre o componente "Detalhes da Ocorr√™ncia"

#### P√ÅGINA: Pacientes
- Reposit√≥rio de informa√ß√µes sobre os pacientes atendidos

---

### PERFIL: MOTORISTA (TABLET)

**OBS:** Tablet fixo na ambul√¢ncia. N√£o precisa aceitar ocorr√™ncias. Quando o Chefe das Ambul√¢ncias atribui a ambul√¢ncia e motorista a uma ocorr√™ncia, ela abre automaticamente no tablet espec√≠fico daquele ve√≠culo.

**REGRAS ESPEC√çFICAS:**
- A ocorr√™ncia aparece automaticamente no tablet no momento em que o Chefe das Ambul√¢ncias atribui aquela ambul√¢ncia espec√≠fica a uma ocorr√™ncia
- Neste momento, o motorista visualiza os detalhes e pode clicar em "Iniciar Ocorr√™ncia"
- **Ao clicar em "Iniciar Ocorr√™ncia", o status muda para "Em Andamento" para todos os integrantes**
- No caso da ambul√¢ncia precisar buscar um m√©dico, o primeiro destino ser√° sempre a resid√™ncia do mesmo
- Ap√≥s buscar o m√©dico, o motorista poder√° clicar em "Pr√≥ximo destino", abrindo o trajeto at√© o exato local da ocorr√™ncia

#### P√ÅGINA: Ocorr√™ncia Ativa

**Conte√∫do exibido no Status "EM ANDAMENTO":**
- Tipo de ocorr√™ncia
- Tipo de Ambul√¢ncia (emerg√™ncia ou b√°sica)
- GPS com localiza√ß√£o do destino e rota em tempo real (INTEGRA√á√ÉO COM WAZE/MAPS/OUTRO - o mais barato e utilizado)
- Bot√£o "Pr√≥ximo destino" (quando aplic√°vel - buscar m√©dico primeiro)
- Mesma integra√ß√£o para trajeto de volta para base
- Lista de integrantes da ambul√¢ncia com nome e link para contato pelo WhatsApp
- Carga hor√°ria (no caso de eventos)

**A√ß√µes dispon√≠veis:**
- Bot√£o "Iniciar Ocorr√™ncia" (muda status de "Confirmada" para "Em Andamento" para todos os integrantes)
- Bot√£o "Pr√≥ximo Destino" (quando h√° m√∫ltiplas paradas)
- Bot√£o "Concluir Ocorr√™ncia" (finaliza a opera√ß√£o)

---

### PERFIL: CHEFE DOS M√âDICOS

#### P√ÅGINA: Dashboard/Home
**Estat√≠sticas exibidas:**
- Ambul√¢ncias Ativas
- Profissionais dispon√≠veis
- Ocorr√™ncias hoje (com op√ß√£o de mudar para semanal ou mensal)
- Tempo m√©dio de resposta das ocorr√™ncias
- Avisos de manuten√ß√£o de ambul√¢ncias ou documenta√ß√£o de motoristas ou falta de equipamento

‚Üí Bot√£o: Criar Nova Ocorr√™ncia
*Redireciona para a P√ÅGINA: Central de Despacho*

#### P√ÅGINA: Central de Despacho
**Conte√∫do exibido:**
- Todos os chamados que ainda n√£o foram criados no sistema
- Ambul√¢ncias dispon√≠veis no momento, filtradas por tipo

‚Üí Componente: Formul√°rio de Cria√ß√£o de Ocorr√™ncia

**Campos do formul√°rio:**
- Tipo de ambul√¢ncia (emerg√™ncia ou b√°sica)
  - **Se B√°sica:** Sistema cria automaticamente 1 vaga para enfermeiro (sem m√©dico)
  - **Se Emerg√™ncia:** Sistema cria automaticamente 1 vaga para m√©dico + 1 vaga para enfermeiro
- Quantidade adicional de enfermeiros (se necess√°rio mais que 1)
- Tipo de trabalho (evento, domiciliar, emerg√™ncia, transfer√™ncia)
- Data
- Local
- Hor√°rio
- Pagamento para cada fun√ß√£o
- Data de pagamento de cada fun√ß√£o

**A√ß√£o:** Lan√ßamento da ocorr√™ncia no sistema para m√©dicos e enfermeiros se cadastrarem conforme vagas criadas

#### P√ÅGINA: Ocorr√™ncias
*(Banco de Dados - Formato Tabela)*
**Mostrar no topo da tabela primeiro as ocorr√™ncias ativas no momento**

‚Üí Componente: Filtros de Busca
- Por data
- Por ID (n√∫mero de ocorr√™ncia)
- Por tipo de ocorr√™ncia (evento, urg√™ncia, domiciliar, transfer√™ncia)
- Por tipo de ambul√¢ncia

‚Üí Componente: Detalhes da Ocorr√™ncia (Modal/Expandido)

**Conte√∫do para Status "ATIVA" (Confirmada ou Em Andamento):**
- Informa√ß√µes conforme status atual da ocorr√™ncia (mesmas informa√ß√µes que o m√©dico visualiza)
- Op√ß√£o de enviar avisos ao vivo para todos os integrantes da ocorr√™ncia

**Conte√∫do para Status "CONCLU√çDA":**
- Local da ocorr√™ncia
- Dura√ß√£o desde a chamada at√© a conclus√£o
- Informa√ß√µes do paciente ou dos pacientes: Nome, Idade, Quadro cl√≠nico
- Informa√ß√£o do ve√≠culo utilizado (Placa)
- Tipo de ocorr√™ncia
- Local
- Funcion√°rios que participaram

#### P√ÅGINA: Rastreamento
‚Üí Componente: Mapa Interativo
- Exibe localiza√ß√£o de todas as ambul√¢ncias ativas em servi√ßo
- Ao clicar em uma ambul√¢ncia individual, abre o componente "Detalhes da Ocorr√™ncia"

#### P√ÅGINA: Ambul√¢ncias
*(Banco de Dados)*

‚Üí Componente: Bot√£o para Cadastro de Nova Ambul√¢ncia
**A√ß√£o:** Ao clicar no bot√£o, abrir formul√°rio para ser preenchido e cadastrar nova ambul√¢ncia

‚Üí Componente: Formul√°rio para Cadastro
**Campos:**
- Marca do carro
- Modelo do carro
- Ano
- Motor
- Placa
- Kilometragem
- √öltima revis√£o

‚Üí Componente: Lista de Ambul√¢ncias
*Ao clicar em uma ambul√¢ncia espec√≠fica, expande/abre componente de detalhes*

‚Üí Componente: Detalhes da Ambul√¢ncia
**Conte√∫do exibido:**
- √öltimas ocorr√™ncias atendidas (ao clicar em uma ocorr√™ncia, o sistema leva para p√°gina "Ocorr√™ncias" com a ocorr√™ncia em quest√£o aberta)
- **Estat√≠sticas:**
  - Gastos
  - N√∫mero de ocorr√™ncias atendidas (diariamente, semanalmente, mensal e anual)
  - Porcentagem por tipo de atendimento (emerg√™ncia, evento, domiciliar ou transfer√™ncia)

#### P√ÅGINA: Profissionais
*(Banco de Dados - Formato Tabela)*

**Colunas da tabela:**
- Nome completo
- Fun√ß√£o
- CPF
- Email
- Telefone
- Idade
- Sexo

#### P√ÅGINA: Pacientes
*(Banco de Dados - Formato Tabela)*

**Colunas da tabela:**
- Nome, Idade, Sexo, Data do √∫ltimo atendimento, Local, M√©dico que atendeu, Ocorr√™ncia, Queixa principal

‚Üí Componente: Hist√≥rico do Paciente (Expandido)
- Lista com √∫ltimos atendimentos e hist√≥rico
- Ao clicar em um atendimento: visualiza√ß√£o do prontu√°rio e arquivos do m√©dico sobre aquele atendimento

#### P√ÅGINA: Escala
‚Üí Componente: Calend√°rio de Escala
**Funcionalidades:**
- Sele√ß√£o de quem est√° de licen√ßa
- Defini√ß√£o de quem trabalha em certos dias da semana
- Manuten√ß√£o atualizada do dashboard sobre disponibilidade dos profissionais

---

### PERFIL: CHEFE DAS AMBUL√ÇNCIAS

#### P√ÅGINA: Dashboard/Home
**Estat√≠sticas exibidas:**
- Ambul√¢ncias dispon√≠veis
- Ambul√¢ncias em manuten√ß√£o
- Gastos m√©dios da frota/por ambul√¢ncia/por ocorr√™ncia (mensal/semanal/di√°rio)

‚Üí Componente: Card de Ambul√¢ncia (Clic√°vel)
*Ao clicar em uma ambul√¢ncia espec√≠fica no dashboard*

**Informa√ß√µes exibidas:**
- Tanque de gasolina
- √öltima revis√£o
- Kilometragem
- Ano
- Modelo
- Motor
- Placa

#### P√ÅGINA: Status Ambul√¢ncias
**Funcionalidades principais:**
- Controle de manuten√ß√£o e verifica√ß√£o t√©cnica dos ve√≠culos
- Visualiza√ß√£o das ambul√¢ncias que est√£o em ocorr√™ncia no momento
- Ao clicar em uma ambul√¢ncia em ocorr√™ncia, s√£o abertos os detalhes da ocorr√™ncia no status "Em andamento"

**Responsabilidades do perfil:**
- Acompanhamento do estado dos ve√≠culos (Kilometragem, revis√£o, gastos com gasolina, etc.)
- Verifica√ß√£o di√°ria dos par√¢metros t√©cnicos da ambul√¢ncia
- **N√ÉO √© respons√°vel por equipamentos m√©dicos** (essa responsabilidade √© do Chefe dos Enfermeiros)

‚Üí Componente: Lista de Ambul√¢ncias com Status

**Status poss√≠veis:**
- "Pronta" - Ambul√¢ncia liberada para opera√ß√£o (verifica√ß√µes t√©cnica E m√©dica completas)
- "Pendente" - Aguardando verifica√ß√µes (status autom√°tico ap√≥s retorno √† base)
- "REVIS√ÉO" - Ambul√¢ncia passou da kilometragem recomendada para revis√£o

**Regras autom√°ticas:**
- Quando uma ocorr√™ncia √© conclu√≠da e retorna para base, automaticamente o status no sistema muda para "Pendente"
- Sistema sinaliza status "REVIS√ÉO" caso kilometragem recomendada tenha sido ultrapassada

#### P√ÅGINA: Atribui√ß√£o de Ocorr√™ncias
**Funcionalidades principais:**
- Gerenciamento de ocorr√™ncias confirmadas aguardando atribui√ß√£o de ve√≠culo e motorista
- **Esta p√°gina existe apenas no perfil do Chefe das Ambul√¢ncias**

**Responsabilidade do perfil:**
- **Atribuir ambul√¢ncia e motorista espec√≠ficos a cada ocorr√™ncia confirmada**
- √â o dever do Chefe das Ambul√¢ncias fazer isso antes de cada ambul√¢ncia sair para atender uma ocorr√™ncia

‚Üí Componente: Lista de Ocorr√™ncias Confirmadas
**Conte√∫do exibido:**
- **Apenas ocorr√™ncias com status "CONFIRMADA"** (todas as fun√ß√µes preenchidas pelos funcion√°rios, aguardando atribui√ß√£o)

‚Üí Componente: Modal de Atribui√ß√£o de Recursos
*Ao clicar em uma ocorr√™ncia confirmada*

**Funcionalidades:**
- Visualiza√ß√£o dos detalhes da ocorr√™ncia (incluindo tipo: Emerg√™ncia ou B√°sica)
- Sele√ß√£o de ambul√¢ncia espec√≠fica (entre as dispon√≠veis com status "Pronta" **do mesmo tipo** da ocorr√™ncia)
- Sele√ß√£o de motorista espec√≠fico (entre os dispon√≠veis)
- Bot√£o "Confirmar Atribui√ß√£o"

**A√ß√£o ap√≥s confirmar atribui√ß√£o:**
- **Status da ocorr√™ncia permanece "CONFIRMADA"** (n√£o muda ainda)
- Ocorr√™ncia √© vinculada √† ambul√¢ncia e motorista selecionados
- **Tablet da ambul√¢ncia espec√≠fica abre automaticamente a ocorr√™ncia**
- Motorista visualiza a ocorr√™ncia e o bot√£o "Iniciar Ocorr√™ncia"
- **Somente quando o motorista clicar em "Iniciar Ocorr√™ncia" o status muda para "Em Andamento"**
- Placa da ambul√¢ncia passa a aparecer nos detalhes da ocorr√™ncia para todos os participantes

‚Üí Componente: Detalhes e Checklist da Ambul√¢ncia
*Acionado ao clicar em uma ambul√¢ncia espec√≠fica na lista de status*

**Sub-componente: Checklist de Ve√≠culo**
**Funcionalidades:**
- Checklist dos par√¢metros t√©cnicos da ambul√¢ncia:
  - Gasolina
  - Kilometragem
  - Temperatura do ve√≠culo
  - Press√£o dos pneus
  - Data para pr√≥xima revis√£o
- Op√ß√£o de dar "check" em cada item
- **Realizado diariamente no in√≠cio do dia**

---

### PERFIL: CHEFE DOS ENFERMEIROS

**Funcionalidades Gerais:**
- Pode enviar avisos e notas para seus funcion√°rios antes ou durante uma ocorr√™ncia
- **Respons√°vel pela verifica√ß√£o de equipamentos m√©dicos nas ambul√¢ncias**
- Realiza verifica√ß√£o matinal de todas as ambul√¢ncias diariamente

#### P√ÅGINA: Dashboard/Home
**Estat√≠sticas exibidas:**
- Ambul√¢ncias prontas (equipamentos m√©dicos verificados)
- Ambul√¢ncias pendentes de verifica√ß√£o
- Alertas de reposi√ß√£o de materiais

#### P√ÅGINA: Status de Equipamentos M√©dicos
**Funcionalidades principais:**
- Controle e libera√ß√£o de ambul√¢ncias para opera√ß√µes (aspecto m√©dico)
- Gest√£o de estoque de materiais m√©dicos
- **Verifica√ß√£o matinal de todas as ambul√¢ncias no in√≠cio do dia**

**Responsabilidades do perfil:**
- Abastecimento de materiais m√©dicos nas ambul√¢ncias
- Verificar e repor equipamentos e utens√≠lios antes de uma ambul√¢ncia sair
- **"Liberar" uma ambul√¢ncia para opera√ß√£o ap√≥s verifica√ß√£o de equipamentos m√©dicos**

‚Üí Componente: Lista de Ambul√¢ncias com Status de Equipamentos
**Informa√ß√µes exibidas:**
- Todas as ambul√¢ncias
- Status de verifica√ß√£o de equipamentos m√©dicos
- Indica√ß√£o de materiais a repor (baseado no consumo registrado pelos m√©dicos)

‚Üí Componente: Checklist de Equipamentos M√©dicos
*Acionado ao clicar em uma ambul√¢ncia espec√≠fica*

**Funcionalidades:**
- **PRIMEIRO:** Definir o tipo de opera√ß√£o da ambul√¢ncia (Emerg√™ncia ou B√°sica)
  - Esta escolha define qual checklist de equipamentos ser√° utilizado
- Checklist de todos os equipamentos m√©dicos necess√°rios conforme tipo selecionado
- **Cada tipo de ambul√¢ncia tem checklist diferente**
- Visualiza√ß√£o de quantidade atual de cada material (atualizado automaticamente pelo registro do m√©dico)
- Indica√ß√£o de materiais que precisam reposi√ß√£o
- Op√ß√£o de dar "check" em cada equipamento ap√≥s reposi√ß√£o
- Bot√£o para marcar ambul√¢ncia como "Pronta para opera√ß√£o"

**Lista Completa de Equipamentos para Checklist:**

**OBS:** No database, cada item ser√° classificado como "Emerg√™ncia" ou "B√°sica" e tamb√©m por categoria. Esta classifica√ß√£o ser√° definida posteriormente.

**CATEGORIA: KIT VIAS A√âREAS / AMBU/BOLSA**
- Ambu Adulto (Adu.)
- Ambu Infantil (Inf.)
- M√°scara para Ambu
- M√°scara com Bolsa e Reservat√≥rio Adulto (M√°sc. Bolsa Reser. Adu.)
- M√°scara com Bolsa e Reservat√≥rio Infantil (M√°sc. Bolsa Reser. Inf.)
- Tubo Orotraqueal (TOT) N¬∫ 3.5, 4.5, 5.5, 6.5, 7.5, 8.5
- C√¢nula de Guedel N¬∫ 00, 1, 2, 3, 4, 5, 6
- Teste Laringosc√≥pio
- L√¢minas Curvas e Retas
- M√°scara Lar√≠ngea (Adu. / Inf.)
- Sonda Aspira√ß√£o N¬∫ 10, 12, 14, 16
- Filtro Respirador
- Fixador de Tubo

**CATEGORIA: KIT EPI'S INDIVIDUAL**
- Luva est√©ril (Pares)
- Luva de procedimento (Caixa)
- M√°scara N95 (Individual)
- √ìculos
- M√°scara Cir√∫rgica
- Touca descart√°vel

**CATEGORIA: KIT PROCEDIMENTO E PUN√á√ÉO**
- Atadura de crepe
- Compressa e Gaze
- Bandagem Triangular
- Esparadrapo / Micropore
- Jelco N¬∫ 18, 20, 22, 24
- Scalpe N¬∫ 19, 21, 23, 25, 27
- Agulhas e Seringas (diversos tamanhos)
- Three-way (torneirinha de 3 vias)
- Equipo macrogotas

**CATEGORIA: MATERIAIS EL√âTRICOS**
- Ox√≠metro
- Esfigmoman√¥metro
- Glicos√≠metro
- Lanterna
- Term√¥metro

**CATEGORIA: MATERIAL AMB (Geral)**
- Fita de glicemia
- Ficha de atendimento
- Manta t√©rmica
- Talas (P, M, G)
- Head block / imobilizador cabe√ßa
- KED e Cinto
- Colar cervical (P, M, G)
- Sacos de lixo (infectante e comum)
- Cobertor ou len√ßol
- Frasco de aspira√ß√£o e extens√£o
- Cilindro de O2 (fixo e m√≥vel)
- V√°lvula com man√¥metro
- Descarpack
- Chave de Oxig√™nio
- Tesoura
- Kit Queimado
- √Ålcool 70% / Antiss√©ptico

**CATEGORIA: KIT SUTURA BOLSA**
- Bisturi com l√¢mina
- Fio de sutura
- Porta Agulha / Hemost√°tica
- Pin√ßa Anat√¥mica / Dente de Rato
- Tesoura √çris

**CATEGORIA: KIT SONDAGEM BOLSA**
- Sonda Vesical de Demora (SVD)
- Sonda Vesical de Al√≠vio (SVA)
- Sonda Nasoenteral (SNE)
- Umidificador

**A√ß√£o ap√≥s marcar como "Pronta":**
- Ambul√¢ncia fica dispon√≠vel para ser atribu√≠da a ocorr√™ncias pelo Chefe das Ambul√¢ncias
- Apenas ambul√¢ncias com status "Pronta" (checklists t√©cnico E m√©dico aprovados) podem ser atribu√≠das a ocorr√™ncias
- **Ambul√¢ncia fica classificada com o tipo definido (Emerg√™ncia ou B√°sica) at√© nova verifica√ß√£o**

**Rotina Matinal:**
- No in√≠cio de cada dia, o Chefe dos Enfermeiros verifica todas as ambul√¢ncias
- **Define o tipo de cada ambul√¢ncia (Emerg√™ncia ou B√°sica)** antes de iniciar checklist
- Completa checklist correspondente ao tipo escolhido
- Rep√µe materiais conforme necess√°rio
- Objetivo: deixar toda a frota com status "Pronta" no in√≠cio do dia
- √Ä medida que voltam de ocorr√™ncias, status atualiza automaticamente para "Pendente"

---

## COMPONENTES COMPARTILHADOS

### Componente: Detalhes da Ocorr√™ncia
*Componente reutiliz√°vel em m√∫ltiplos contextos*

**Utilizado em:**
- Dashboard do M√©dico
- Agenda do M√©dico
- Dashboard do Enfermeiro
- Agenda do Enfermeiro
- Ocorr√™ncia Ativa do Motorista (Tablet)
- P√°gina de Ocorr√™ncias do Chefe dos M√©dicos
- P√°gina de Rastreamento do Chefe dos M√©dicos
- P√°gina de Status Ambul√¢ncias do Chefe das Ambul√¢ncias (quando ambul√¢ncia est√° em ocorr√™ncia)
- **P√°gina de Atribui√ß√£o de Ocorr√™ncias do Chefe das Ambul√¢ncias (ocorr√™ncias confirmadas)**

**Varia√ß√µes:**
- Conte√∫do adaptado conforme perfil do usu√°rio
- Conte√∫do adaptado conforme status da ocorr√™ncia (Em Aberto, Confirmada, Em Andamento, Conclu√≠da)

---

## REGRAS DE NEG√ìCIO E L√ìGICA DO SISTEMA

### Estados das Ocorr√™ncias

1. **Em Aberto** - Ocorr√™ncia criada pelo Chefe dos M√©dicos, aguardando profissionais aceitarem (vis√≠vel para m√©dicos e enfermeiros)
2. **Confirmada** - Todas as fun√ß√µes necess√°rias foram confirmadas pelos funcion√°rios (mudan√ßa autom√°tica). Aguardando Chefe das Ambul√¢ncias atribuir ve√≠culo e motorista
3. **Em Andamento** - Chefe das Ambul√¢ncias atribuiu ambul√¢ncia e motorista. Motorista iniciou a ocorr√™ncia no tablet, opera√ß√£o ativa
4. **Conclu√≠da** - Opera√ß√£o finalizada

### Tipos de Trabalho

#### Evento
- Ambul√¢ncia pode ficar o dia todo
- Ambul√¢ncia fica de "plant√£o", caso algu√©m necessite de atendimento m√©dico durante o evento

#### Domiciliar
- Pessoa est√° pagando para ser atendida por um m√©dico e enfermeiro na sua resid√™ncia
- Ambul√¢ncia vai at√© a casa do paciente e atende um √∫nico paciente naquela ocorr√™ncia

#### Emerg√™ncia
- *(A ser definido)*

#### Transfer√™ncia
- Algum paciente que est√° em uma cl√≠nica ou hospital parceiro precisa ser movido para outro local
- A empresa leva o paciente em uma de suas ambul√¢ncias
- Classificado como "remo√ß√£o" no sistema

### Tipos de Ambul√¢ncia

**Cada tipo determina a composi√ß√£o da equipe e tem checklist de equipamentos m√©dicos diferente**

#### B√°sica
- **Equipe:** 1 Enfermeiro (sem m√©dico)
- **Checklist:** Itens classificados como "B√°sica" no database (a serem definidos quais itens da lista completa)

#### Emerg√™ncia
- **Equipe:** 1 M√©dico + 1 Enfermeiro (obrigatoriamente)
- **Checklist:** Itens classificados como "Emerg√™ncia" no database (a serem definidos quais itens da lista completa)

**Nota:** O tipo de ambul√¢ncia escolhido ao criar a ocorr√™ncia define automaticamente as vagas de profissionais dispon√≠veis

### Status das Ambul√¢ncias

#### Pronta
- Liberada para opera√ß√£o ap√≥s checklists completos
- **Requer aprova√ß√£o de AMBOS:**
  - Checklist t√©cnico (Chefe das Ambul√¢ncias)
  - Checklist de equipamentos m√©dicos (Chefe dos Enfermeiros)

#### Pendente
- Aguardando verifica√ß√£o e checklist
- Status autom√°tico ap√≥s retorno √† base

#### REVIS√ÉO
- Necessita revis√£o t√©cnica
- Kilometragem ultrapassou limite recomendado

### L√≥gica de Disponibilidade

- Profissionais de folga n√£o veem ofertas de ocorr√™ncias no Dashboard
- Profissionais j√° alocados em outro job no mesmo hor√°rio n√£o veem ofertas
- Sistema verifica automaticamente a agenda antes de exibir ocorr√™ncias dispon√≠veis

### Fluxo Completo de Mudan√ßa de Status

1. **Chefe dos M√©dicos cria ocorr√™ncia** ‚Üí Status: "Em Aberto"
2. **Profissionais aceitam participa√ß√£o** ‚Üí Status muda automaticamente para "Confirmada" quando todas as fun√ß√µes s√£o preenchidas
3. **Chefe das Ambul√¢ncias atribui ambul√¢ncia e motorista espec√≠ficos √† ocorr√™ncia** ‚Üí Ocorr√™ncia abre automaticamente no tablet da ambul√¢ncia atribu√≠da
4. **Motorista clica em "Iniciar Ocorr√™ncia" no tablet** ‚Üí Status: "Em Andamento" (para todos os integrantes)
5. **Opera√ß√£o finalizada** ‚Üí Status: "Conclu√≠da"
6. **Ambul√¢ncia retorna √† base** ‚Üí Status da ambul√¢ncia muda automaticamente para "Pendente"

### Fluxo de Gest√£o de Materiais M√©dicos

1. **Verifica√ß√£o Matinal:** Chefe dos Enfermeiros define tipo da ambul√¢ncia (Emerg√™ncia ou B√°sica), verifica e rep√µe materiais conforme checklist do tipo ‚Üí Status "Pronta"
2. **Durante Ocorr√™ncia:** M√©dico atende pacientes (n√£o registra consumo ainda)
3. **Final da Ocorr√™ncia:**